<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Set New Password - Prakash Netra</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  padding: 20px;
}
.container {
  background: white;
  padding: 40px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 400px;
  text-align: center;
}
h1 {
  margin-bottom: 20px;
  font-size: 22px;
  color: #1a202c;
}
input {
  width: 100%;
  padding: 12px;
  border: 2px solid #e2e8f0;
  border-radius: 6px;
  margin-bottom: 16px;
  font-size: 14px;
}
input:focus {
  outline: none;
  border-color: #3182ce;
  box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
}
button {
  width: 100%;
  padding: 12px;
  background: #3182ce;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}
button:hover {
  background: #2c5aa0;
}
</style>
</head>
<body>
<div class="container">
  <h1>Set New Password</h1>
  <input type="text" id="otp" placeholder="Enter OTP" required>
  <input type="password" id="newPassword" placeholder="Enter new password (min 8 chars)" minlength="8" required>
  <button onclick="resetPassword()">Reset Password</button>
</div>

<script>
function resetPassword() {
  const enteredOTP = document.getElementById("otp").value.trim();
  const newPassword = document.getElementById("newPassword").value.trim();

  // Retrieve OTP and email stored during reset
  const savedOTP = localStorage.getItem("resetOTP");
  const resetEmail = localStorage.getItem("resetEmail");

  if (!enteredOTP || !newPassword) {
    alert("Please fill all fields.");
    return;
  }

  if (enteredOTP !== savedOTP) {
    alert("Invalid OTP. Please try again.");
    return;
  }

  if (newPassword.length < 8) {
    alert("Password must be at least 8 characters.");
    return;
  }

  // Retrieve all users
  const allUsers = JSON.parse(localStorage.getItem("users")) || [];

  // Find the user with the matching email
  const userIndex = allUsers.findIndex(u => u.email === resetEmail);
  if (userIndex === -1) {
    alert("User not found. Please register first.");
    return;
  }

  // Update password for the user
  allUsers[userIndex].password = newPassword;
  localStorage.setItem("users", JSON.stringify(allUsers));

  // Clear temporary OTP/email
  localStorage.removeItem("resetOTP");
  localStorage.removeItem("resetEmail");

  alert("Password reset successful! Please login with your new password.");
  window.location.href = "login1.html";
}
</script>
</body>
</html>
